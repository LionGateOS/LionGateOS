/* =========================================================
   LionGateOS â€” Visual Layer Module (Capabilities Included)
   STATUS: Implemented but OFF by default (opt-in)
   NOTE: Effects activate ONLY when .ve-enabled is present on <html>
   ========================================================= */

:root{
  /* Master */
  --ve-motion-intensity: 0.50; /* 0..1 */
  --ve-enabled: 0; /* 0/1 */

  /* Ambient background */
  --ve-ambient-enabled: 0; /* 0/1 */
  --ve-ambient-strength: 0.35; /* 0..1 */
  --ve-ambient-speed: 0.35; /* 0..1 */

  /* Borders */
  --ve-borders-enabled: 0; /* 0/1 */
  --ve-borders-style: 0; /* 0=off, 1=static, 2=conic */
  --ve-borders-thickness: 2px;
  --ve-borders-glow: 0.35; /* 0..1 */
  --ve-borders-speed: 0.35; /* 0..1 */

  /* Glow */
  --ve-glow-enabled: 0; /* 0/1 */
  --ve-glow-strength: 0.35; /* 0..1 */

  /* Palette inputs (Core/Appearance own these vars; Visual Layer only consumes) */
  --lg-accent: #5da9ff;
  --lg-accent2: #b15dff;
}

/* Root flags (JS toggles these) */
html.ve-enabled{ --ve-enabled: 1; }
html.ve-ambient-on{ --ve-ambient-enabled: 1; }
html.ve-borders-on{ --ve-borders-enabled: 1; }
html.ve-glow-on{ --ve-glow-enabled: 1; }

/* =========================================================
   A) Ambient Animated Background (OFF by default)
   Applied to BODY only, never overlays panels.
   ========================================================= */
@keyframes veAmbientDrift {
  0%   { background-position: 0% 0%, 100% 100%, 0 0; }
  50%  { background-position: 100% 0%, 0% 100%, 0 0; }
  100% { background-position: 0% 0%, 100% 100%, 0 0; }
}

/* This overlay is subtle and behind everything. */
body::before{
  content: "";
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: -1;
  opacity: 0;
  transition: opacity 260ms ease;
  background-image:
    radial-gradient(900px 500px at 20% 25%, color-mix(in srgb, var(--lg-accent2) 22%, transparent), transparent 60%),
    radial-gradient(900px 500px at 75% 30%, color-mix(in srgb, var(--lg-accent) 18%, transparent), transparent 60%),
    linear-gradient(180deg, transparent, transparent);
  background-size: 140% 140%, 140% 140%, 100% 100%;
  background-repeat: no-repeat;
  filter: blur(calc(14px + (20px * var(--ve-motion-intensity))));
  transform: translateZ(0);
}

/* Enable only when master + ambient on */
html.ve-enabled.ve-ambient-on body::before{
  opacity: clamp(0, var(--ve-ambient-strength), 1);
  animation: veAmbientDrift calc(18s - (10s * var(--ve-ambient-speed))) ease-in-out infinite;
}

/* =========================================================
   B) Panel Border Effects (OFF by default)
   Includes static accent + animated conic-gradient border.
   Applied to common "panel/card" containers.
   ========================================================= */

@keyframes veConicSpin {
  to { transform: rotate(360deg); }
}

/* Target candidates (broad, but safe: only activates when classes enabled) */
:where(.panel, .card, .tile, .pane, .surface, .glass, .frame, .app-surface, #appHost, .appHost, .app-host){
  position: relative;
}

/* Border shell pseudo-element (masked to border) */
:where(.panel, .card, .tile, .pane, .surface, .glass, .frame, .app-surface, #appHost, .appHost, .app-host)::after{
  content: "";
  position: absolute;
  inset: calc(-1 * var(--ve-borders-thickness));
  border-radius: inherit;
  padding: var(--ve-borders-thickness);
  opacity: 0;
  pointer-events: none;
  transition: opacity 220ms ease;
  /* Mask to show border only */
  -webkit-mask:
    linear-gradient(#000 0 0) content-box,
    linear-gradient(#000 0 0);
  -webkit-mask-composite: xor;
  mask-composite: exclude;
}

/* Activate border only for "active" / "focused" panels OR global when host is active */
:where(.panel.is-active, .panel.active, .card.is-active, .card.active, .tile.is-active, .tile.active, .pane.is-active, .pane.active,
       .surface.is-active, .surface.active, .frame.is-active, .frame.active,
       #appHost.is-active, #appHost.active,
       body.ve-all-panels-borders :where(.panel, .card, .tile, .pane, .surface, .glass, .frame, .app-surface, #appHost, .appHost, .app-host)
)::after{
  opacity: 0; /* still gated below */
}

/* Master + Borders enabled */
html.ve-enabled.ve-borders-on :where(.panel, .card, .tile, .pane, .surface, .glass, .frame, .app-surface, #appHost, .appHost, .app-host)::after{
  opacity: clamp(0, var(--ve-borders-glow), 1);
}

/* Static accent border (style=1) */
html.ve-enabled.ve-borders-on[data-ve-borders-style="static"]
  :where(.panel, .card, .tile, .pane, .surface, .glass, .frame, .app-surface, #appHost, .appHost, .app-host)::after{
  background: linear-gradient(90deg,
    color-mix(in srgb, var(--lg-accent) 90%, transparent),
    color-mix(in srgb, var(--lg-accent2) 90%, transparent)
  );
  filter: blur(calc(2px + (6px * var(--ve-motion-intensity))));
}

/* Animated conic-gradient border (style=2) */
html.ve-enabled.ve-borders-on[data-ve-borders-style="conic"]
  :where(.panel, .card, .tile, .pane, .surface, .glass, .frame, .app-surface, #appHost, .appHost, .app-host)::after{
  background: conic-gradient(
    from 0deg,
    color-mix(in srgb, var(--lg-accent) 95%, transparent),
    color-mix(in srgb, var(--lg-accent2) 95%, transparent),
    color-mix(in srgb, var(--lg-accent) 95%, transparent)
  );
  transform: rotate(0deg);
  animation: veConicSpin calc(10s - (7s * var(--ve-borders-speed))) linear infinite;
  filter: blur(calc(1px + (5px * var(--ve-motion-intensity))));
}

/* Reduce motion: stop spin but keep border visible */
html.ve-reduce-motion[data-ve-borders-style="conic"]
  :where(.panel, .card, .tile, .pane, .surface, .glass, .frame, .app-surface, #appHost, .appHost, .app-host)::after{
  animation: none !important;
}

/* =========================================================
   C) Panel Glow (OFF by default)
   ========================================================= */
:where(.panel, .card, .tile, .pane, .surface, .glass, .frame, .app-surface, #appHost, .appHost, .app-host){
  --ve-glow-a: color-mix(in srgb, var(--lg-accent) 22%, transparent);
  --ve-glow-b: color-mix(in srgb, var(--lg-accent2) 18%, transparent);
}

html.ve-enabled.ve-glow-on :where(.panel, .card, .tile, .pane, .surface, .glass, .frame, .app-surface, #appHost, .appHost, .app-host){
  box-shadow:
    0 0 calc(14px + (18px * var(--ve-motion-intensity))) color-mix(in srgb, var(--ve-glow-a) calc(100% * var(--ve-glow-strength)), transparent),
    0 0 calc(22px + (26px * var(--ve-motion-intensity))) color-mix(in srgb, var(--ve-glow-b) calc(100% * var(--ve-glow-strength)), transparent);
}

/* =========================================================
   D) Safety Defaults
   ========================================================= */
/* Nothing runs unless master is enabled */
html:not(.ve-enabled) body::before{
  animation: none !important;
  opacity: 0 !important;
}

/* Respect reduced motion flag (set by engine when requested) */
html.ve-reduce-motion body::before{
  animation: none !important;
}
