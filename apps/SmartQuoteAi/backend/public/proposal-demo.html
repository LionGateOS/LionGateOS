
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>SmartQuoteAI Pro – Proposal Draft Console</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <style>
      :root {
        --bg: #050814;
        --bg-elevated: #070a1e;
        --bg-panel: #0b1028;
        --accent: #ffd36b;
        --accent-soft: rgba(255, 211, 107, 0.18);
        --accent-strong: rgba(255, 211, 107, 0.8);
        --border-soft: rgba(132, 172, 255, 0.45);
        --border-strong: rgba(132, 172, 255, 0.9);
        --text-main: #f5f5ff;
        --text-soft: #c3c7ff;
        --error: #ff9f9f;
        --success: #9dffbf;
      }

      * { box-sizing: border-box; }

      body {
        margin: 0;
        padding: 26px 14px 34px;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        background: radial-gradient(circle at top, #191d46 0, #050814 60%);
        color: var(--text-main);
      }

      .frame {
        max-width: 1200px;
        margin: 0 auto;
      }

      .shell {
        position: relative;
        border-radius: 26px;
        padding: 24px 24px 26px;
        border: 1px solid var(--border-soft);
        background: radial-gradient(circle at 6% -10%, #3c447b 0, #11152f 32%, #050814 78%);
        box-shadow:
          0 26px 80px rgba(0,0,0,0.85),
          0 0 0 1px rgba(8,10,30,0.9);
        overflow: hidden;
      }

      .shell::before {
        content: "";
        position: absolute;
        inset: -40%;
        background:
          radial-gradient(circle at 0 0, rgba(255,211,107,0.16), transparent 60%),
          radial-gradient(circle at 100% 20%, rgba(144,205,255,0.12), transparent 55%);
        opacity: 0.9;
        pointer-events: none;
      }

      .shell-inner {
        position: relative;
        z-index: 1;
      }

      .top-bar {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 16px;
        margin-bottom: 18px;
      }

      .app-badge {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 4px 14px;
        border-radius: 999px;
        border: 1px solid var(--accent-strong);
        background: radial-gradient(circle at top left, var(--accent-soft), rgba(0,0,0,0.5));
        font-size: 0.78rem;
        letter-spacing: 0.12em;
        text-transform: uppercase;
      }

      .app-badge-dot {
        width: 7px;
        height: 7px;
        border-radius: 999px;
        background: var(--accent);
        box-shadow: 0 0 12px var(--accent);
      }

      h1 {
        margin: 8px 0 4px;
        font-size: 1.55rem;
        letter-spacing: 0.07em;
        text-transform: uppercase;
      }

      .subtitle {
        margin: 0;
        font-size: 0.9rem;
        max-width: 640px;
        color: var(--text-soft);
      }

      .top-right {
        text-align: right;
        font-size: 0.8rem;
        color: var(--text-soft);
      }

      .status-pill {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 3px 10px;
        border-radius: 999px;
        border: 1px solid rgba(157,255,191,0.8);
        background: rgba(10,46,24,0.9);
        color: var(--success);
        margin-bottom: 4px;
      }

      .status-dot {
        width: 7px;
        height: 7px;
        border-radius: 999px;
        background: var(--success);
        box-shadow: 0 0 10px rgba(157,255,191,0.9);
      }

      .mini-label {
        font-size: 0.75rem;
        letter-spacing: 0.14em;
        text-transform: uppercase;
      }

      .layout {
        display: grid;
        grid-template-columns: minmax(0, 3fr) minmax(0, 3.3fr);
        gap: 18px;
        margin-top: 18px;
      }

      @media (max-width: 940px) {
        .shell { padding: 20px 16px 22px; }
        .layout { grid-template-columns: minmax(0, 1fr); }
      }

      .panel {
        border-radius: 20px;
        background: linear-gradient(150deg, rgba(10,15,40,0.98), rgba(4,7,24,0.98));
        border: 1px solid rgba(100,140,230,0.75);
        padding: 14px 16px 16px;
        box-shadow:
          0 18px 46px rgba(0,0,0,0.9),
          0 0 0 1px rgba(2,7,30,0.9);
      }

      .panel-header {
        display: flex;
        justify-content: space-between;
        align-items: baseline;
        gap: 10px;
        margin-bottom: 10px;
      }

      .panel-title {
        font-size: 0.98rem;
        font-weight: 600;
      }

      .panel-subtitle {
        font-size: 0.8rem;
        color: var(--text-soft);
      }

      .badge-soft {
        padding: 2px 8px;
        border-radius: 999px;
        border: 1px solid rgba(132,172,255,0.8);
        font-size: 0.72rem;
        color: var(--text-soft);
      }

      .section-label {
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 0.14em;
        color: rgba(199,206,255,0.88);
        margin-bottom: 8px;
      }

      .row {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 10px;
      }

      .field {
        flex: 1;
        min-width: 0;
      }

      label {
        display: block;
        font-size: 0.8rem;
        color: var(--text-soft);
        margin-bottom: 4px;
      }

      input[type="text"],
      input[type="number"],
      textarea {
        width: 100%;
        border-radius: 14px;
        border: 1px solid rgba(160,188,255,0.9);
        background: radial-gradient(circle at top, rgba(34,46,96,0.95), rgba(7,10,34,0.98));
        color: var(--text-main);
        font: inherit;
        padding: 7px 11px;
        font-size: 0.9rem;
      }

      textarea {
        resize: vertical;
        min-height: 70px;
        max-height: 200px;
        line-height: 1.4;
      }

      input::placeholder,
      textarea::placeholder {
        color: rgba(190,198,255,0.6);
      }

      input:focus,
      textarea:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow:
          0 0 0 1px rgba(10,10,18,0.9),
          0 0 0 2px rgba(255,211,107,0.5);
      }

      .hint {
        font-size: 0.75rem;
        color: var(--text-soft);
        margin-bottom: 8px;
      }

      .actions {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        align-items: center;
        margin-top: 6px;
      }

      button {
        border-radius: 999px;
        border: none;
        padding: 9px 18px;
        background: linear-gradient(125deg, var(--accent), #ff9f6b);
        color: #151515;
        font-weight: 600;
        cursor: pointer;
        font-size: 0.9rem;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }

      button:hover { filter: brightness(1.05); }
      button:active { transform: translateY(1px); filter: brightness(0.97); }

      .secondary {
        background: transparent;
        border: 1px solid rgba(154,185,255,0.85);
        color: var(--text-main);
      }

      .status-line {
        font-size: 0.8rem;
        color: var(--text-soft);
        margin-top: 4px;
      }

      .status-line.error { color: var(--error); }

      .document {
        border-radius: 18px;
        padding: 14px 16px 16px;
        background: radial-gradient(circle at top left, rgba(46,60,120,0.85), rgba(8,10,30,0.98));
        border: 1px solid var(--border-strong);
        font-size: 0.9rem;
      }

      .doc-header {
        display: flex;
        justify-content: space-between;
        align-items: baseline;
        gap: 8px;
        margin-bottom: 10px;
      }

      .doc-title {
        font-size: 1.05rem;
        font-weight: 600;
      }

      .doc-meta {
        font-size: 0.78rem;
        color: var(--text-soft);
        text-align: right;
      }

      .doc-section {
        margin-top: 10px;
      }

      .doc-section h3 {
        font-size: 0.96rem;
        margin: 0 0 4px;
        color: var(--accent);
      }

      .doc-section p {
        margin: 0;
        color: var(--text-soft);
        line-height: 1.5;
      }

      .doc-section + .doc-section {
        border-top: 1px dashed rgba(164,192,255,0.7);
        padding-top: 8px;
      }

      .doc-pill-row {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        font-size: 0.78rem;
        margin-top: 6px;
      }

      .doc-pill {
        padding: 3px 9px;
        border-radius: 999px;
        border: 1px solid rgba(138,180,255,0.9);
        background: rgba(5,12,40,0.96);
        color: var(--text-soft);
      }

      .doc-pill strong {
        color: var(--text-main);
      }

      .placeholder {
        font-size: 0.86rem;
        color: var(--text-soft);
        opacity: 0.9;
      }
    </style>
  </head>
  <body>
    <div class="frame">
      <div class="shell">
        <div class="shell-inner">
          <div class="top-bar">
            <div>
              <div class="app-badge">
                <span class="app-badge-dot"></span>
                <span>SmartQuoteAI Pro • Proposal Draft</span>
              </div>
              <h1>Proposal Draft Console</h1>
              <p class="subtitle">
                Take a live estimate from SmartQuoteAI Pro and turn it into a structured client-facing proposal
                in a single pass. All content stays on your machine.
              </p>
            </div>
            <div class="top-right">
              <div class="status-pill">
                <span class="status-dot"></span>
                Proposal API Ready
              </div>
              <div class="mini-label">Backend Link: /api/proposal/generate</div>
            </div>
          </div>

          <div class="layout">
            <!-- LEFT: Form -->
            <section class="panel">
              <div class="panel-header">
                <div>
                  <div class="section-label">Inputs</div>
                  <div class="panel-title">Proposal Metadata & Summary</div>
                </div>
                <span class="badge-soft">Step 1 of 2 – Draft</span>
              </div>

              <p class="panel-subtitle">
                Fill in basic client and project information. If you already have a total from the estimator,
                you can paste it below to keep everything aligned.
              </p>

              <div class="row">
                <div class="field">
                  <label for="clientName">Client name</label>
                  <input id="clientName" type="text" placeholder="Acme Corporation" />
                </div>
                <div class="field">
                  <label for="projectName">Project name</label>
                  <input id="projectName" type="text" placeholder="SmartQuoteAI Pro Rollout" />
                </div>
              </div>

              <div class="field">
                <label for="summary">Executive summary (1–3 paragraphs)</label>
                <textarea id="summary" placeholder="High-level summary of the engagement, outcomes, and strategic value."></textarea>
              </div>

              <div class="row">
                <div class="field">
                  <label for="risks">Risks & considerations (optional)</label>
                  <textarea id="risks" placeholder="Key risks, dependencies, or constraints the client should be aware of."></textarea>
                </div>
                <div class="field">
                  <label for="assumptions">Assumptions (optional)</label>
                  <textarea id="assumptions" placeholder="Core assumptions about scope, access, timelines, or collaboration."></textarea>
                </div>
              </div>

              <div class="field">
                <label for="investment">Total investment (incl. buffer)</label>
                <input id="investment" type="number" min="0" step="100" placeholder="e.g. 18500" />
                <div class="hint">
                  You can paste the number from the Smart Estimator total. Currency defaults to USD.
                </div>
              </div>

              <div class="actions">
                <button id="generateBtn">
                  Generate proposal draft
                </button>
                <button id="clearBtn" class="secondary">
                  Clear fields
                </button>
              </div>
              <div id="status" class="status-line"></div>
            </section>

            <!-- RIGHT: Proposal Document Preview -->
            <section class="panel">
              <div class="panel-header">
                <div>
                  <div class="section-label">Output</div>
                  <div class="panel-title">Proposal Preview</div>
                </div>
                <span class="badge-soft">Step 2 – Review</span>
              </div>

              <div id="doc" class="document">
                <div id="docPlaceholder" class="placeholder">
                  Fill out the form on the left and click <strong>Generate proposal draft</strong>.
                  Your proposal will appear here as a structured document you can reuse in email, PDF, or slides.
                </div>
              </div>
            </section>
          </div>
        </div>
      </div>
    </div>

    <script>
      const clientNameInput = document.getElementById("clientName");
      const projectNameInput = document.getElementById("projectName");
      const summaryInput = document.getElementById("summary");
      const risksInput = document.getElementById("risks");
      const assumptionsInput = document.getElementById("assumptions");
      const investmentInput = document.getElementById("investment");
      const generateBtn = document.getElementById("generateBtn");
      const clearBtn = document.getElementById("clearBtn");
      const statusLine = document.getElementById("status");
      const docContainer = document.getElementById("doc");
      const docPlaceholder = document.getElementById("docPlaceholder");

      function setStatus(message, isError = false) {
        statusLine.textContent = message;
        statusLine.classList.toggle("error", isError);
      }

      function clearForm() {
        clientNameInput.value = "";
        projectNameInput.value = "";
        summaryInput.value = "";
        risksInput.value = "";
        assumptionsInput.value = "";
        investmentInput.value = "";
        setStatus("");
        docContainer.innerHTML = "";
        docContainer.appendChild(docPlaceholder);
      }

      clearBtn.addEventListener("click", (e) => {
        e.preventDefault();
        clearForm();
      });

      function buildFallbackEstimate(total) {
        const amount = Number(total) || 0;
        return {
          label: "SmartQuoteAI Pro – Proposal Draft",
          hours: 0,
          hourlyRate: 0,
          riskBufferPercent: 0,
          totalWithBuffer: amount,
          currency: "USD",
        };
      }

      function renderProposal(proposal) {
        const wrapper = document.createElement("div");
        wrapper.innerHTML = "";

        const header = document.createElement("div");
        header.className = "doc-header";

        const title = document.createElement("div");
        title.className = "doc-title";
        title.textContent = proposal.meta.projectName || "SmartQuoteAI Pro Proposal";

        const meta = document.createElement("div");
        meta.className = "doc-meta";
        meta.innerHTML =
          "<div><strong>Client:</strong> " +
          (proposal.meta.clientName || "—") +
          "</div>" +
          "<div><strong>Prepared by:</strong> " +
          (proposal.meta.preparedBy || "SmartQuoteAI Pro") +
          "</div>" +
          "<div><strong>Version:</strong> " +
          proposal.meta.version +
          "</div>";

        header.appendChild(title);
        header.appendChild(meta);

        const pillRow = document.createElement("div");
        pillRow.className = "doc-pill-row";
        pillRow.innerHTML =
          "<div class='doc-pill'><strong>Total:</strong> $" +
          proposal.estimate.totalWithBuffer.toLocaleString() +
          " " +
          proposal.estimate.currency +
          "</div>" +
          "<div class='doc-pill'><strong>Label:</strong> " +
          proposal.estimate.label +
          "</div>";

        wrapper.appendChild(header);
        wrapper.appendChild(pillRow);

        proposal.sections.forEach((section) => {
          const sec = document.createElement("div");
          sec.className = "doc-section";
          const h3 = document.createElement("h3");
          h3.textContent = section.title;
          const p = document.createElement("p");
          p.textContent = section.body;
          sec.appendChild(h3);
          sec.appendChild(p);
          wrapper.appendChild(sec);
        });

        docContainer.innerHTML = "";
        docContainer.appendChild(wrapper);
      }

      async function generateProposal() {
        setStatus("");
        const clientName = clientNameInput.value.trim();
        const projectName = projectNameInput.value.trim();
        const summary = summaryInput.value.trim();
        const risks = risksInput.value.trim();
        const assumptions = assumptionsInput.value.trim();
        const investment = investmentInput.value.trim();

        if (!clientName || !projectName || !summary) {
          setStatus("Please fill client name, project name, and summary.", true);
          return;
        }

        const estimate = buildFallbackEstimate(investment);

        try {
          setStatus("Sending draft to SmartQuoteAI Pro backend…");
          const res = await fetch("/api/proposal/generate", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              clientName,
              projectName,
              summary,
              risks: risks || undefined,
              assumptions: assumptions || undefined,
              estimate,
            }),
          });

          const json = await res.json();
          if (!json.ok) {
            throw new Error(json.error || "Backend responded with an error.");
          }

          renderProposal(json.data);
          setStatus("Proposal draft generated successfully.");
        } catch (err) {
          console.error(err);
          setStatus(
            "Could not generate proposal draft. Ensure the backend Phase 4A is installed and /api/proposal/generate is available.",
            true
          );
        }
      }

      generateBtn.addEventListener("click", (e) => {
        e.preventDefault();
        generateProposal();
      });
    </script>
  </body>
</html>
