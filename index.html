<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<meta name="theme-color" content="#0b0f1a"/>
<title>LionGateOS</title>

<script>
try {
  if(window.__LGOS_HARDENED__){}
  else { window.__LGOS_HARDENED__ = true; }
} catch(e){}
(function(){ try {
  var h=document.documentElement;
  h.dataset.osVersion = h.dataset.osVersion || "9.0";
  h.dataset.osBuild   = h.dataset.osBuild   || "20251223-165827Z";
  h.dataset.osState   = h.dataset.osState   || "initializing";
} catch(e){} })();
</script>

<style>
:root{
  --bg:#070a12;
  --panel:rgba(14,18,34,.72);
  --text:#e8edf7;
  --muted:#aab6d6;
  --trace:#5aa0ff;
  --radius:26px;
  --stroke:2px;
}
html,body{
  margin:0;height:100%;
  background:var(--bg);
  color:var(--text);
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
}
.hidden{display:none!important}

#ambient{
  position:fixed; inset:0; z-index:0; pointer-events:none;
  background:
    radial-gradient(900px 600px at 20% 20%, rgba(90,160,255,.10), transparent 60%),
    radial-gradient(900px 650px at 85% 55%, rgba(215,179,90,.08), transparent 65%),
    url("assets/ambient_purple.png");
  background-size:cover;
  background-position:center;
  opacity:.35;
}

#sparkles{position:fixed; inset:0; z-index:1; pointer-events:none;}
.spark{ 
  position:absolute;
  width:4px;height:4px;border-radius:50%;
  background:rgba(140,180,255,.95);
  box-shadow:0 0 14px rgba(140,180,255,.95);
  animation:floatUp linear infinite;
}
@keyframes floatUp{
  from{transform:translateY(0)}
  to{transform:translateY(-160vh)}
}
@media (prefers-reduced-motion: reduce){
  #sparkles{display:none}
}

#splash{
  position:fixed; inset:0; z-index:9999; background:#000;
  display:flex; align-items:center; justify-content:center;
}
#splash.hide{display:none}
#splash video{width:100%;height:100%;object-fit:contain}

#gateway{
  position:relative; z-index:2;
  min-height:100%;
  display:flex; align-items:center; justify-content:center;
  padding:40px;
}
.panel{
  max-width:1100px; width:100%;
  display:grid; grid-template-columns:1fr 1fr; gap:24px;
}
@media(max-width:900px){ .panel{grid-template-columns:1fr} }

.card{
  position:relative;
  background:var(--panel);
  border-radius:var(--radius);
  box-shadow:0 22px 60px rgba(0,0,0,.55);
  overflow:hidden;
  padding:30px;
}

.edgeRunner{position:absolute; inset:0; pointer-events:none; z-index:5;}
.edgeRunner svg{width:100%; height:100%; display:block;}

.logo{max-width:420px; width:100%; display:block; margin:0 auto;}
footer{margin-top:22px; font-size:12px; color:var(--muted);}

.launcher{display:flex; flex-direction:column; gap:14px;}
.launcher a{
  display:flex; align-items:center; justify-content:space-between;
  padding:18px;
  border-radius:18px;
  border:1px solid rgba(255,255,255,.14);
  text-decoration:none;
  color:#fff;
  background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(0,0,0,.08));
}
.launcher a.disabled{opacity:.5; pointer-events:none;}
</style>

<link rel="icon" href="/favicon.ico"/>
<link rel="icon" sizes="32x32" type="image/png" href="/favicon-32.png"/>
<link rel="apple-touch-icon" sizes="180x180" href="/favicon-180.png"/>
<link rel="icon" sizes="256x256" type="image/png" href="/favicon-256.png"/>
</head>

<body>
<div id="ambient" aria-hidden="true"></div>
<div id="sparkles" aria-hidden="true"></div>

<div id="splash">
  <video autoplay muted playsinline id="splashVideo" preload="none">
    <source src="assets/splash.mp4?v=lgos-splash-20251222" type="video/mp4"/>
  </video>
</div>

<div id="gateway" class="hidden">
  <div class="panel">

    <div class="card" id="cardLeft">
      <div class="edgeRunner" aria-hidden="true"><svg id="svgLeft"></svg></div>
      <img class="logo" src="assets/liongateos_logo.png" alt="LionGateOS"/>
      <footer>Â© <span id="year"></span> LionGateOS</footer>
    </div>


    <div class="card launcher" id="cardRight">
      <div class="edgeRunner" aria-hidden="true"><svg id="svgRight"></svg></div>
      <a class="disabled"><span>Enter LionGateOS</span><span>Coming soon</span></a>
      <a class="disabled"><span>App Store</span><span>Coming soon</span></a>
      <a class="disabled"><span>AI Tools</span><span>Coming soon</span></a>
      <a href="https://smartquoteai.pro" target="_blank" rel="noopener"><span>SmartQuote AI</span><span>Open</span></a>
      <a href="https://liongateostravels.com" target="_blank" rel="noopener"><span>LionGateOS Travels</span><span>Open</span></a>
    </div>


  </div>
</div>

<script>
const KEY="lgos_splash_seen_v11";
const splash=document.getElementById("splash");
const gateway=document.getElementById("gateway");
const video=document.getElementById("splashVideo");
document.getElementById("year").textContent = new Date().getFullYear();

function showGateway(){
  splash.classList.add("hide");
  gateway.classList.remove("hidden");
  startOS();
}
if (localStorage.getItem(KEY)) {
  showGateway();
} else {
  video.addEventListener("ended", ()=>{ localStorage.setItem(KEY,"1"); showGateway(); });
  video.addEventListener("error", ()=>{ localStorage.setItem(KEY,"1"); showGateway(); });
}

(function initSparkles(){
  const reduce = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
  if(reduce) return;
  const c = document.getElementById("sparkles");
  if(!c || c.children.length) return;

  const cores = navigator.hardwareConcurrency || 4;
  const mem   = navigator.deviceMemory || 4;
  const lowPower = (cores <= 4) || (mem <= 4) || /Mobi|Android/i.test(navigator.userAgent);

  const COUNT = lowPower ? 18 : 28;
  for(let i=0;i<COUNT;i++) {
    const d=document.createElement("div");
    d.className="spark";
    d.style.left = (Math.random()*100) + "vw";
    d.style.bottom = (-30 - Math.random()*260) + "px";
    d.style.opacity = (0.40 + Math.random()*0.55).toFixed(2);
    d.style.animationDuration = (lowPower ? (18 + Math.random()*14) : (14 + Math.random()*18)).toFixed(2) + "s";
    d.style.animationDelay = (-Math.random()*18).toFixed(2) + "s";
    c.appendChild(d);
  }
})();

function roundedRectPath(w, h, r, inset){
  const x = inset, y = inset;
  const W = Math.max(1, w - inset*2);
  const H = Math.max(1, h - inset*2);
  const rr = Math.max(0, Math.min(r, Math.min(W, H)/2));
  return [
    `M ${x+rr} ${y}`,
    `H ${x+W-rr}`,
    `A ${rr} ${rr} 0 0 1 ${x+W} ${y+rr}`,
    `V ${y+H-rr}`,
    `A ${rr} ${rr} 0 0 1 ${x+W-rr} ${y+H}`,
    `H ${x+rr}`,
    `A ${rr} ${rr} 0 0 1 ${x} ${y+H-rr}`,
    `V ${y+rr}`,
    `A ${rr} ${rr} 0 0 1 ${x+rr} ${y}`,
    "Z"
  ].join(" ");
}

function waitForStableBox(el, frames=8, maxMs=2600){
  return new Promise((resolve)=>{
    let stable=0, last=null;
    const start=performance.now();
    function sample(){
      const r=el.getBoundingClientRect();
      const cur=[Math.round(r.width), Math.round(r.height)];
      if(last && cur[0]===last[0] && cur[1]===last[1] && cur[0]>0 && cur[1]>0) stable++;
      else { stable=0; last=cur; }
      if(stable>=frames || (performance.now()-start)>maxMs) {
        resolve({w:cur[0], h:cur[1]});
        return;
      }
      requestAnimationFrame(sample);
    }
    requestAnimationFrame(sample);
  });
}

function TracerController(cfg){
  const card = cfg.card;
  const svg  = cfg.svg;
  const dir  = cfg.dir;
  const radius = cfg.radius;
  const stroke = cfg.stroke;

  const NS="http://www.w3.org/2000/svg";
  let L = 0;
  let rafId = null;
  let seeded = false;
  let basePath=null, runnerA=null, runnerB=null;

  function build(){
    const r = card.getBoundingClientRect();
    const w = Math.max(1, Math.round(r.width));
    const h = Math.max(1, Math.round(r.height));

    svg.innerHTML = "";
    svg.setAttribute("viewBox", `0 0 ${w} ${h}`);
    svg.setAttribute("preserveAspectRatio", "none");

    const inset = stroke/2;
    const d = roundedRectPath(w, h, radius, inset);

    basePath=document.createElementNS(NS,"path");
    basePath.setAttribute("d", d);
    basePath.setAttribute("fill","none");
    basePath.setAttribute("stroke","rgba(255,255,255,.12)");
    basePath.setAttribute("stroke-width", Math.max(1, stroke-0.5));
    basePath.setAttribute("stroke-linejoin","round");
    basePath.setAttribute("stroke-linecap","round");
    basePath.setAttribute("vector-effect","non-scaling-stroke");
    svg.appendChild(basePath);

    runnerA=document.createElementNS(NS,"path");
    runnerB=document.createElementNS(NS,"path");
    [runnerA, runnerB].forEach(p=>{
      p.setAttribute("d", d);
      p.setAttribute("fill","none");
      p.setAttribute("stroke", getComputedStyle(document.documentElement).getPropertyValue('--trace').trim() || "#5aa0ff");
      p.setAttribute("stroke-width", stroke);
      p.setAttribute("stroke-linejoin","round");
      p.setAttribute("stroke-linecap","round");
      p.setAttribute("vector-effect","non-scaling-stroke");
      p.style.filter = "drop-shadow(0 0 8px rgba(90,160,255,.38))";
      p.style.opacity = "1";
      svg.appendChild(p);
    });
    L = runnerA.getTotalLength();
  }

  function norm(x){ x = x % L; if(x<0) x+=L; return x; }
  function segLen(){ return L * (0.12 + Math.random()*0.13); }
  function travelLen(){ return L * (0.90 + Math.random()*0.10); }

  function ensureSep(aStart, aSeg, bSeg){
    const buffer = L * 0.03;
    const minGap = aSeg + bSeg + buffer;
    for(let i=0;i<24;i++) {
      const cand = Math.random()*L;
      const dist = Math.abs(norm(cand - aStart));
      const gap = Math.min(dist, L - dist);
      if(gap >= minGap) return cand;
    }
    return norm(aStart + minGap);
  }

  function makeRunner(path){
    return {
      path,
      active:false,
      start:0,
      seg:0,
      travel:0,
      speed:0,
      t0:0,
      lapMs:0,
      growMs:380,
      shrinkMs:380
    };
  }

  const A = makeRunner(runnerA);
  const B = makeRunner(runnerB);

  function dashArray(seg, cur){
    const s = Math.max(0.001, Math.min(seg, cur));
    return `${s} ${Math.max(1, L - s)}`;
  }

  function seed(now){
    seeded = true;
    const cores = navigator.hardwareConcurrency || 4;
    const mem   = navigator.deviceMemory || 4;
    const lowPower = (cores <= 4) || (mem <= 4) || /Mobi|Android/i.test(navigator.userAgent);

    const wantTwo = !lowPower && (Math.random() < 0.30);
    A.active = true;
    B.active = wantTwo;

    const seconds = lowPower ? (10.5 + Math.random()*2.5) : (9.0 + Math.random()*2.0);
    const speed = (L / (seconds*1000)) * dir; // constant per card

    A.seg = segLen();
    A.start = Math.random()*L;
    A.travel = travelLen();
    A.speed = speed;
    A.t0 = now;
    A.lapMs = Math.max(4500, Math.abs(A.travel / A.speed));

    if(B.active){
      B.seg = segLen();
      B.start = ensureSep(A.start, A.seg, B.seg);
      B.travel = travelLen();
      B.speed = speed;
      B.t0 = now;
      B.lapMs = Math.max(4500, Math.abs(B.travel / B.speed));
      B.path.style.opacity = "1";
      B.path.setAttribute("stroke-dasharray", dashArray(B.seg, 0.001));
    } else {
      B.path.style.opacity = "0";
    }

    A.path.style.opacity = "1";
    A.path.setAttribute("stroke-dasharray", dashArray(A.seg, 0.001));
  }

  function phase(r, now){
    const e = now - r.t0;
    const runMs = Math.max(0, r.lapMs - r.growMs - r.shrinkMs);
    if(e < r.growMs) return {p:"grow", u:e/r.growMs, runT:0};
    if(e < r.growMs + runMs) return {p:"run", u:(e-r.growMs)/runMs, runT:(e-r.growMs)};
    if(e < r.lapMs) return {p:"shrink", u:(e-r.growMs-runMs)/r.shrinkMs, runT:runMs};
    return {p:"done", u:1, runT:runMs};
  }

  function update(r, now){
    if(!r.active) return;
    const ph = phase(r, now);

    let cur = r.seg;
    if(ph.p==="grow") cur = r.seg * ph.u;
    else if(ph.p==="shrink") cur = r.seg * (1 - ph.u);

    const travelElapsed = (ph.p==="grow")
      ? (ph.u * r.growMs * 0.35)
      : (r.growMs*0.35 + ph.runT + (ph.p==="shrink" ? (ph.u * r.shrinkMs) : 0));

    const off = norm(r.start + travelElapsed * r.speed);
    r.path.setAttribute("stroke-dasharray", dashArray(r.seg, cur));
    r.path.setAttribute("stroke-dashoffset", off);
  }

  function tick(now){
    if(!seeded) seed(now);

    let done = true;
    for(const r of [A,B]){
      if(!r.active) continue;
      if((now - r.t0) < r.lapMs) done = false;
    }
    if(done) seed(now);

    update(A, now);
    update(B, now);

    rafId = requestAnimationFrame(tick);
  }

  async function start(){
    await waitForStableBox(card, 8, 2600);
    build();
    await new Promise(res=>requestAnimationFrame(()=>requestAnimationFrame(res)));
    build();
    if(rafId) cancelAnimationFrame(rafId);
    seeded = false;
    rafId = requestAnimationFrame(tick);
  }

  function stop(){
    if(rafId) cancelAnimationFrame(rafId);
    rafId = null;
  }

  if(window.ResizeObserver){
    const ro = new ResizeObserver(()=>{ stop(); start(); });
    ro.observe(card);
  } else {
    window.addEventListener("resize", ()=>{ stop(); start(); }, {passive:true});
    window.addEventListener("orientationchange", ()=>{ stop(); start(); }, {passive:true});
  }
  document.addEventListener("visibilitychange", ()=>{ if(!document.hidden){ stop(); start(); } });

  return { start, stop };
}

let __osStarted=false;
function startOS(){
  if(__osStarted) return;
  __osStarted=true;

  const cardLeft = document.getElementById("cardLeft");
  const cardRight = document.getElementById("cardRight");
  const svgLeft = document.getElementById("svgLeft");
  const svgRight = document.getElementById("svgRight");

  const left = TracerController({ card: cardLeft, svg: svgLeft, dir:+1, radius:26, stroke:2 });
  const right = TracerController({ card: cardRight, svg: svgRight, dir:-1, radius:26, stroke:2 });

  requestAnimationFrame(()=>requestAnimationFrame(()=>{ left.start(); right.start(); }));
}
</script>

</body>
</html>
