import React, { useEffect, useMemo, useState } from "react";

type PanelConfig = {
  title: string;
  body: string;
};

const STORAGE_KEY = "lgos.shell.activePanel";
const DEFAULT_PANEL_ID = "dashboard";

const getInitialPanelId = (): string => {
  if (typeof window === "undefined") return DEFAULT_PANEL_ID;
  try {
    return window.localStorage.getItem(STORAGE_KEY) || DEFAULT_PANEL_ID;
  } catch {
    return DEFAULT_PANEL_ID;
  }
};

const WorkspaceHostComponent: React.FC = () => {
  const [activePanelId, setActivePanelId] = useState(getInitialPanelId);

  const panels = useMemo<Record<string, PanelConfig>>(
    () => ({
      dashboard: {
        title: "Command Center",
        body: "High-level overview of LionGateOS activity.",
      },
      "workspace-hub": {
        title: "Workspace Hub",
        body: "Central workspace management surface.",
      },
      smartquote: {
        title: "SmartQuote AI",
        body: "SmartQuote AI workspace.",
      },
      "travel-orchestrator": {
        title: "Travel Orchestrator",
        body: "Travel orchestration workspace.",
      },
      settings: {
        title: "System Settings",
        body: "Global OS configuration.",
      },
      "theme-engine": {
        title: "Theme Engine",
        body: "Theme and appearance control.",
      },
      "shell-diagnostics": {
        title: "Shell Diagnostics",
        body: "System diagnostics and logs.",
      },
    }),
    []
  );

  useEffect(() => {
    const handler = (event: Event) => {
      const custom = event as CustomEvent<{ routeId?: string }>;
      if (!custom.detail?.routeId) return;

      setActivePanelId(custom.detail.routeId);
      try {
        window.localStorage.setItem(STORAGE_KEY, custom.detail.routeId);
      } catch {}
    };

    window.addEventListener("os-shell:navigate", handler);
    return () => window.removeEventListener("os-shell:navigate", handler);
  }, []);

  const panel = panels[activePanelId] ?? panels[DEFAULT_PANEL_ID];

  return (
    <main className="os-workspace-host">
      <div className="os-workspace-panel">
        <h1>{panel.title}</h1>

        {/* VERY OBVIOUS CONFIRMATION */}
        <div
          style={{
            marginTop: "8px",
            marginBottom: "16px",
            padding: "6px 12px",
            display: "inline-block",
            borderRadius: "999px",
            background: "linear-gradient(90deg,#2563eb,#60a5fa)",
            color: "white",
            fontWeight: 600,
            letterSpacing: "0.04em",
          }}
        >
          ACTIVE WORKSPACE
        </div>

        <p>{panel.body}</p>
      </div>
    </main>
  );
};

export default React.memo(WorkspaceHostComponent);
